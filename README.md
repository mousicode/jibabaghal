جیب‌بغل (JibBaghal)

یک پلتفرم تبلیغات ویدئویی بر بستر وردپرس که کاربر با تماشای کامل ویدیو + پاسخ صحیح به آزمون ۴گزینه‌ای، باعث کاهش بودجه‌ی اسپانسر می‌شود. پروژه از چند افزونه‌ی ماژولار تشکیل شده است تا توسعه و نگهداری آسان باشد.

معماری افزونه‌ها
1. JBG Core

هسته‌ی مشترک (constants، loader، util).

مسیر: wp-content/plugins/jbg-core/

فقط زیرساخت، وابستگی برای همه افزونه‌های دیگر.

2. JBG Ads Feed

تعریف نوع پست سفارشی jbg_ad (هر آگهی ویدیویی).

متاباکس‌ها: CPV (هزینه هر بازدید کامل)، بودجه کل، بودجه باقی‌مانده، Priority Boost.

Taxonomy: jbg_brand (برند اسپانسر)، jbg_category (دسته‌بندی ویدیو).

REST API:

/wp-json/jbg/v1/feed → لیست آگهی‌ها، مرتب‌شده بر اساس:

CPV (نزولی)

اگر مساوی بود: بودجه باقی‌مانده (نزولی)

اگر مساوی بود: priority_boost

شورتکد [jbg_ads] برای لیست کارت ویدیوها با ظاهر شبیه یوتیوب:

تصویر بندانگشتی

عنوان

برند

تعداد بازدید

زمان انتشار (human readable: «x روز پیش»)

دکمه «مشاهده»

ViewBadge: در صفحه‌ی تکی ویدیو، زیر پلیر → عنوان، برند، بازدید، زمان انتشار نمایش داده می‌شود.

3. JBG Player

پلیر سفارشی مبتنی بر Plyr.js + HLS.js.

محدودیت‌ها:

کاربر نمی‌تواند seek به جلو کند (فقط عقب‌رفتن تا جایی که دیده آزاد است).

وقتی ۹۹–۱۰۰٪ دیده شد، دکمه «Start Quiz» فعال می‌شود.

استایل واکنش‌گرا (aspect-ratio 16:9، راست‌چین روی موبایل).

ایونت jbg:watched_ok روی document dispatch می‌شود (برای هماهنگی با کوییز/بیلینگ).

4. JBG Quiz

متاباکس روی هر jbg_ad: یک سوال + ۴ پاسخ + تعیین گزینه درست.

نمایش آزمون بعد از اتمام ویدیو.

پاسخ از طریق REST → /wp-json/jbg/v1/quiz/submit

اگر پاسخ درست بود → ایونت jbg_quiz_passed شلیک می‌شود.

5. JBG Billing

هندل کردن jbg_quiz_passed.

یک بار برای هر کاربر/آگهی هزینه را از بودجه کم می‌کند (CPV).

لاگ در جدول wp_jbg_views:

ad_id

user_id

amount

created_at

ip, user-agent

شمارنده بازدید (jbg_views_count) روی متای پست sync می‌شود.

ستون هزینه خرج‌شده در taxonomy jbg_brand.

صفحه‌ی لاگ‌ها در ادمین.

پشتیبانی از حالت یک بازدید در هر ۲۴ ساعت (قابل توسعه).

ظاهر و UX

لیست کارت‌ها: شبیه گالری یوتیوب (تصویر بندانگشتی بالا، عنوان زیر آن، برند+بازدید+زمان انتشار در خط بعد، دکمه مشاهده).

صفحه تکی: ویدیو در بالا، زیر آن عنوان سمت راست + برند/بازدید/زمان سمت چپ (در دسکتاپ یک خط؛ در موبایل عمودی).

دکمه «Start Quiz» فقط وقتی کل ویدیو دیده شد فعال است.
